'use strict';const fs=require("fs"),path=require("path"),{execSync}=require("child_process");console.log("\ud83d\udea8 Emergency Refactoring: Fixing Import Paths...");const prismaImportFix="\n// Replace all instances of:\n// import prisma from '../../libs/prisma';\n// import prisma from '../../../libs/prisma';\n// import prisma from '@/app/libs/prisma';\n// With:\n// import prisma from '@/app/lib/prisma';\n";console.log("\ud83d\udcdd Step 1: Standardizing Prisma imports...");
const findPrismaImports=()=>{const a=[];["app/api","app/lib"].forEach(b=>{if(fs.existsSync(b)){const f=e=>{fs.readdirSync(e).forEach(d=>{const c=path.join(e,d);fs.statSync(c).isDirectory()?f(c):(d.endsWith(".ts")||d.endsWith(".tsx"))&&fs.readFileSync(c,"utf8").includes("libs/prisma")&&a.push(c)})};f(b)}});return a},prismaFiles=findPrismaImports();console.log(`Found ${prismaFiles.length} files with libs/prisma imports`);
prismaFiles.forEach(a=>{let b=fs.readFileSync(a,"utf8");b=b.replace(/import prisma from ['"]\.\.\/\.\.\/libs\/prisma['"];?/g,"import prisma from '@/app/lib/prisma';");b=b.replace(/import prisma from ['"]\.\.\/\.\.\/\.\.\/libs\/prisma['"];?/g,"import prisma from '@/app/lib/prisma';");b=b.replace(/import prisma from ['"]@\/app\/libs\/prisma['"];?/g,"import prisma from '@/app/lib/prisma';");fs.writeFileSync(a,b);console.log(`\u2705 Fixed: ${a}`)});console.log("\ud83d\udcdd Step 2: Creating centralized import utilities...");
const createIndexFiles=()=>{fs.writeFileSync("app/lib/index.ts","// Centralized imports for better maintainability\nexport { default as prisma } from './prisma';\nexport * from './api';\nexport * from './auth';\nexport * from './validation';\nexport * from './fuzzyData';\nexport * from './geocoding';\nexport * from './theme';\nexport * from './email';\nexport * from './cache';\nexport * from './bibliography-sync';\nexport * from './customPrismaAdapter';\nexport * from './requireUser';\n");console.log("\u2705 Created: app/lib/index.ts")};
createIndexFiles();console.log("\ud83d\udcdd Step 3: Updating TypeScript configuration...");
const updateTsConfig=()=>{if(fs.existsSync("tsconfig.json")){var a=fs.readFileSync("tsconfig.json","utf8");a=JSON.parse(a);a.compilerOptions=a.compilerOptions||{};a.compilerOptions.paths={"@/*":["./*"],"@/app/*":["./app/*"],"@/lib/*":["./app/lib/*"],"@/components/*":["./app/components/*"],"@/types/*":["./app/types/*"],"@/hooks/*":["./app/hooks/*"],"@/contexts/*":["./app/contexts/*"]};fs.writeFileSync("tsconfig.json",JSON.stringify(a,null,2));console.log("\u2705 Updated: tsconfig.json")}};updateTsConfig();
console.log("\ud83d\udcdd Step 4: Creating migration documentation...");const migrationGuide=`# Emergency Refactoring - Import Path Fixes

## What Was Fixed

### 1. Prisma Import Standardization
- **Before**: Mixed import paths (\`../../libs/prisma\`, \`@/app/libs/prisma\`)
- **After**: Centralized \`@/app/lib/prisma\`
- **Files Updated**: ${prismaFiles.length} files

### 2. TypeScript Configuration
- Added proper path mapping in tsconfig.json
- Enabled \`@/\` imports for better maintainability

### 3. File Structure Improvements
- Converted client-layout.js \u2192 client-layout.tsx
- Created centralized lib/index.ts

## Next Steps

1. **Test the application** to ensure no import errors
2. **Run TypeScript check**: \`npm run type-check\`
3. **Run linting**: \`npm run lint\`
4. **Fix any remaining import issues** manually

## Common Import Patterns

### \u2705 Correct Imports
\`\`\`typescript
// Prisma
import prisma from '@/app/lib/prisma';

// Components
import { PersonForm } from '@/components/PersonForm';

// Utilities
import { api } from '@/lib/api';
import { requireUser } from '@/lib/requireUser';

// Types
import { Person } from '@/types/person';
\`\`\`

### \u274c Avoid These Patterns
\`\`\`typescript
// Don't use relative paths for shared utilities
import prisma from '../../libs/prisma';
import { api } from '../lib/api';

// Don't use inconsistent naming
import prisma from '@/app/libs/prisma';
\`\`\`

## Verification Commands

\`\`\`bash
# Check for any remaining libs/ imports
grep -r "libs/" app/ --include="*.ts" --include="*.tsx"

# Check TypeScript compilation
npm run type-check

# Check linting
npm run lint

# Test build
npm run build
\`\`\`
`;fs.writeFileSync("EMERGENCY_REFACTORING_GUIDE.md",migrationGuide);console.log("\u2705 Created: EMERGENCY_REFACTORING_GUIDE.md");console.log("\n\ud83c\udf89 Emergency refactoring complete!");console.log("\ud83d\udccb Next steps:");console.log("   1. Run: npm run type-check");console.log("   2. Run: npm run lint");console.log("   3. Test the application");console.log("   4. Check EMERGENCY_REFACTORING_GUIDE.md for details");