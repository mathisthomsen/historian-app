'use strict';const {PrismaClient}=require("@prisma/client"),prisma=new PrismaClient;
async function testNewAPIs(){console.log("\ud83e\uddea Testing New API Routes...\n");try{console.log("1. Testing Sources API...");const a=await prisma.sources.create({data:{userId:"test-user-id",title:"Test Source - Historical Document",author:"Test Author",publication:"Test Publication",year:2024,reliability:.85,notes:"Test source for API validation"}});console.log("   \u2705 Source created:",a.id);console.log("\n2. Testing Statements API...");const f=await prisma.statements.create({data:{userId:"test-user-id",
content:"This is a test statement about a historical event.",confidence:.75,source_id:a.id}});console.log("   \u2705 Statement created:",f.id);console.log("\n3. Testing Person/Event Creation...");const c=await prisma.persons.create({data:{userId:"test-user-id",first_name:"Test",last_name:"Person",birth_date:new Date("1990-01-01")}});console.log("   \u2705 Person created:",c.id);const d=await prisma.events.create({data:{userId:"test-user-id",title:"Test Event",description:"A test historical event",
date:new Date("2024-01-01"),location:"Test Location"}});console.log("   \u2705 Event created:",d.id);console.log("\n4. Testing Person-Event Relations API...");const g=await prisma.personEventRelations.create({data:{userId:"test-user-id",person_id:c.id,event_id:d.id,relationship_type:"participant",statement_id:f.id}});console.log("   \u2705 Person-Event Relation created:",g.id);console.log("\n5. Testing Source-on-Relations API...");const k=await prisma.sourceOnRelations.create({data:{userId:"test-user-id",
source_id:a.id,relation_id:g.id}});console.log("   \u2705 Source-on-Relation created:",k.id);console.log("\n6. Testing Relationship Queries...");const e=await prisma.events.findFirst({where:{id:d.id},include:{personEventRelations:{include:{person:!0,statement:{include:{source:!0}},sourceOnRelations:{include:{source:!0}}}}}});console.log("   \u2705 Event participants:",e.personEventRelations.length);console.log("   \u2705 Participant name:",e.personEventRelations[0].person.first_name);console.log("   \u2705 Relationship type:",
e.personEventRelations[0].relationship_type);const h=await prisma.persons.findFirst({where:{id:c.id},include:{personEventRelations:{include:{event:!0,statement:{include:{source:!0}}}}}});console.log("   \u2705 Person events:",h.personEventRelations.length);console.log("   \u2705 Event title:",h.personEventRelations[0].event.title);console.log("\n7. Testing Source Statistics...");const b=await prisma.sources.findFirst({where:{id:a.id},include:{statements:!0,sourceOnRelations:{include:{relation:{include:{person:!0,
event:!0}}}}}});console.log("   \u2705 Source statements:",b.statements.length);console.log("   \u2705 Source relations:",b.sourceOnRelations.length);console.log("   \u2705 Total usage:",b.statements.length+b.sourceOnRelations.length);console.log("\n\u2705 All API tests passed!");console.log("\n\ud83c\udfaf New API Structure Summary:");console.log("   - Sources: \u2705 Working");console.log("   - Statements: \u2705 Working");console.log("   - Person-Event Relations: \u2705 Working");console.log("   - Source-on-Relations: \u2705 Working");
console.log("   - Enhanced Events: \u2705 Working");console.log("   - Enhanced Persons: \u2705 Working")}catch(a){console.error("\u274c Test failed:",a)}finally{try{await prisma.sourceOnRelations.deleteMany({where:{userId:"test-user-id"}}),await prisma.personEventRelations.deleteMany({where:{userId:"test-user-id"}}),await prisma.statements.deleteMany({where:{userId:"test-user-id"}}),await prisma.sources.deleteMany({where:{userId:"test-user-id"}}),await prisma.events.deleteMany({where:{userId:"test-user-id"}}),
await prisma.persons.deleteMany({where:{userId:"test-user-id"}}),console.log("\n\ud83e\uddf9 Test data cleaned up")}catch(a){console.error("Cleanup error:",a)}await prisma.$disconnect()}}testNewAPIs().catch(console.error);